library(MASS)
library(AER)
library(plm)
library(pglm)
library(polycor)
library(stargazer)
library(car)
library(dplyr)

#'Setting the working directory
setwd('C:/Users/Jasper/Documents/LEI - internship') #working from home
setwd('M:/My Documents/LEI - internship')           #working from LEI

#Comparing variables across years
data <- read.csv('R-Output/data_corrected.csv')[,3:37]
data$household_id <- as.character(ifelse((data$region %in% c("Harari", "Gambella", "Dire Dawa")), data$household_id, paste(0,data$household_id,sep="")))

#Checking residuals
#http://stats.stackexchange.com/questions/118051/how-to-perform-residual-analysis-for-binary-dichotomous-independent-predictors-i
regdata <- plm.data(data, c("household_id","year"))

fit <- pglm(tech_count ~ 
               #age 
               #+ gender  
               #+ educationlevel 
               #+ hhsize 
               #+ roofmaterial 
               #+ television 
               + area 
               #+ LS
               #+ dist_household 
               #+ croprotate 
               #+ offpart 
               #+ ownership_index 
               #+ extension  
               #+ credit  
               #+ advise 
               #+ oxen 
               #+ dist_road 
               #+ dist_market 
               #+ anntot_avg 
               #+ average_slope 
               #+ nutrient 
               ,data = regdata,
               ,effect = ("individual")         
               , family = poisson,         
               , method = "bfgs"          
               , model="within"
               )




  

b <- coefficients(fit_glm2011)
y.hat <- data2011$tech_count %*% b[-1] + b[1] 
